<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Upload de Arquivo DWG</title>
  </head>
  <body>
    <h2>Enviar Arquivo DWG</h2>
    <form id="uploadForm">
      <label for="name">Nome:</label>
      <input type="text" id="name" name="name" required /><br /><br />

      <label for="file">Arquivo (.dwg, máx. 1MB):</label>
      <input
        type="file"
        id="file"
        name="file"
        accept=".dwg"
        required
      /><br /><br />

      <button type="submit">Enviar</button>
    </form>

    <p id="message"></p>

    <script>
      document
        .getElementById("uploadForm")
        .addEventListener("submit", async function (event) {
          event.preventDefault();

          const name = document.getElementById("name").value;
          const fileInput = document.getElementById("file");
          const file = fileInput.files[0];

          if (!file) {
            alert("Por favor, selecione um arquivo.");
            return;
          }

          if (!file.name.endsWith(".dwg")) {
            alert("Somente arquivos .dwg são permitidos.");
            return;
          }

          if (file.size > 1024 * 1024) {
            alert("O arquivo deve ter no máximo 1MB.");
            return;
          }

          const formData = new FormData();
          formData.append("name", name);
          formData.append("file", file);

          try {
            const response = await fetch("/api/upload", {
              method: "POST",
              body: formData,
            });

            const result = await response.json();

            if (response.ok) {
              document.getElementById("message").textContent =
                "Arquivo enviado com sucesso!";
            } else {
              document.getElementById("message").textContent =
                "Erro ao enviar: " + result.message;
            }
          } catch (error) {
            document.getElementById("message").textContent =
              "Erro na requisição: " + error.message;
          }
        });
    </script>
  </body>
</html>
